import{b as _,g as A,ai as $,a5 as m,a3 as j,t as B,a4 as I,ad as P,T as C,l as V,z as q}from"./DBBIm6QW.js";import{w as D}from"./BA5sWNxj.js";import{q as F}from"./9NAE6nZN.js";import{e as O,k,l as R,ac as z,c,o as i,P as w,O as E,b as d,q as S,K as T,r as L,a as f,X as M,a2 as W,p as s,t as G,w as g}from"#entry";import"./B-dksMZM.js";import"./BYayo6hL.js";import"./DT--psc0.js";const H=O({__name:"CollectionServerForm",props:{collectionId:{default:""},serverUid:{default:""}},setup(U){const r=U,{activeWorkspaceCollections:o}=_(),{servers:b,serverMutators:n}=A(),u=[{label:"URL",key:"url",placeholder:"https://void.scalar.com",type:"text"},{label:"Description",key:"description",placeholder:"Production",type:"text"}],e=k(()=>{const t=o.value.find(a=>a.uid===r.collectionId);return b[t&&typeof r.serverUid=="string"&&r.serverUid==="default"?t.servers[0]??"":t?.servers.find(a=>a===r.serverUid)??""]}),x=k(()=>e.value?.url?e.value.url.match($.PATH)?.map(t=>t.slice(1,-1))??[]:[]);R(x,t=>{if(!e.value)return;const a=e.value.variables?{...e.value.variables}:{};Object.keys(a).forEach(l=>{t.includes(l)||delete a[l]}),t.forEach(l=>{a[l]||(a[l]={default:""})}),n.edit(e.value.uid,"variables",a),m(p.value,"store-update-selected-server-properties",{key:"variables",value:a,options:{disableOldStoreUpdate:!0}})},{immediate:!0});const h=(t,a)=>{!o.value||!e.value||(n.edit(e.value.uid,t,a),(t==="url"||t==="description")&&m(p.value,"store-update-selected-server-properties",{key:t,value:a,options:{disableOldStoreUpdate:!0}}))},y=(t,a)=>{if(!e.value)return;const l=e.value.variables||{};l[t]={...l[t],default:a},n.edit(e.value.uid,"variables",l),m(p.value,"store-update-selected-server-properties",{key:"variables",value:l,options:{disableOldStoreUpdate:!0}})},p=z("wrapper-ref");return(t,a)=>(i(),c("div",{ref:"wrapper-ref",class:T(["divide-0.5 flex w-full flex-col divide-y rounded-b-lg text-sm",e.value?.variables&&"bg-b-1"])},[e.value?(i(),c(E,{key:0},[d(F,{data:e.value,onUpdate:h,options:u},null,8,["data"]),e.value.variables?(i(),S(j,{key:0,variables:e.value.variables,"onUpdate:variable":y},null,8,["variables"])):w("",!0)],64)):w("",!0)],2))}}),X={ref:"wrapper-ref",class:"flex h-full w-full flex-col gap-12 px-1.5 pt-8"},Y={class:"flex flex-col gap-4"},J={class:"rounded-lg border"},K={class:"bg-b-2 flex items-start justify-between rounded-t-lg py-1 pr-1 pl-3 text-sm"},Q={key:1,class:"self-center"},Z={class:"text-c-3 flex h-full items-center justify-center rounded-lg border p-4"},de=O({__name:"CollectionServers",setup(U){const{activeCollection:r}=_(),{servers:o,events:b,serverMutators:n}=A(),u=B(),e=L(null),x=k(()=>!o||!r.value?.servers?[]:Object.values(o).filter(a=>r.value?.servers.includes(a.uid))),h=()=>b.commandPalette.emit({commandName:"Add Server"}),y=()=>{!r.value?.uid||!e.value||(n.delete(e.value,r.value.uid),m(t.value,"scalar-delete-server",{url:o[e.value]?.url??""}),u.hide())},p=a=>{e.value=a,u.show()},t=z("wrapper-ref");return(a,l)=>(i(),c("div",X,[f("div",Y,[l[2]||(l[2]=M('<div class="flex items-start justify-between gap-2"><div class="flex flex-col gap-2"><div class="flex h-8 items-center"><h3 class="font-bold">Servers</h3></div><p class="text-sm"> Add different base URLs for your API. You can use <code class="font-code text-c-2">{variables}</code> for dynamic parts. </p></div></div>',1)),(i(!0),c(E,null,W(x.value,(v,N)=>(i(),c("div",{key:v.uid},[f("div",J,[f("div",K,[v.description?(i(),S(s(I),{key:0,class:"self-center",value:v.description},null,8,["value"])):(i(),c("span",Q,"Server "+G(N+1),1)),d(s(C),{class:"hover:bg-b-3 hover:text-c-1 h-fit p-1.25",variant:"ghost",onClick:ee=>p(v.uid)},{default:g(()=>[d(s(P),{class:"size-3.5"})]),_:2},1032,["onClick"])]),s(r)?(i(),S(H,{key:0,collectionId:s(r).uid,serverUid:v.uid},null,8,["collectionId","serverUid"])):w("",!0)])]))),128)),f("div",Z,[d(s(C),{class:"hover:bg-b-2 hover:text-c-1 flex items-center gap-2",size:"sm",variant:"ghost",onClick:h},{default:g(()=>[d(s(V),{class:"inline-flex",icon:"Add",size:"sm",thickness:"1.5"}),l[1]||(l[1]=f("span",null,"Add Server",-1))]),_:1,__:[1]})])]),d(s(q),{size:"xxs",state:s(u),title:`Delete ${e.value?s(o)[e.value]?.url:"Server"}`},{default:g(()=>[d(D,{variableName:"Server",warningMessage:"Are you sure you want to delete this server? This action cannot be undone.",onClose:l[0]||(l[0]=v=>s(u).hide()),onDelete:y})]),_:1},8,["state","title"])],512))}});export{de as default};
