import{g as G,aa as K,ac as q,a7 as H,T as W,ad as Q,ae as ne,A as te,b as oe,t as D,l as se,z as L}from"./DBBIm6QW.js";import{m as ie}from"./Bs6P4q1d.js";import{w as re}from"./BA5sWNxj.js";import{C as ce}from"./BrS3fbDA.js";import{b as ue}from"./DT--psc0.js";import{J as ve,M as de}from"./CoN6fahc.js";import{e as X,r as C,k as T,l as P,q as $,f as me,o as g,w as f,b as u,c as Y,d as U,O as Z,a2 as ee,K as fe,a9 as pe,p as n,P as ae,a6 as be,B as J,a as p,a3 as he,t as ke}from"#entry";import{x as R,H as xe}from"./Dwcvrvns.js";import"./B-dksMZM.js";import"./BYayo6hL.js";import"./BuJ6anXd.js";const ye=X({__name:"EnvironmentForm",props:{collection:{},environment:{},workspace:{},envVariables:{}},setup(r){const{collectionMutators:t}=G(),s=C([]),z=C(new Set),k=C(new Map),b=C(!1),V=T(()=>{if(!r.environment?.value)return[{key:"",value:""}];try{const e=JSON.parse(r.environment.value),l=Object.entries(e).map(([o,a])=>({key:o,value:String(a)}));return l.length===0?[{key:"",value:""}]:l}catch{return[{key:"",value:""}]}}),F=T(()=>{const e=s.value[s.value.length-1];return e?e.key||e.value?[...s.value,{key:"",value:""}]:s.value:[{key:"",value:""}]}),w=T(()=>{const e=new Map;return s.value.forEach((l,o)=>{if(l.key){const a=e.get(l.key)||[];a.push(o),e.set(l.key,a)}}),k.value.forEach((l,o)=>{if(l){const a=e.get(l)||[];a.push(o),e.set(l,a)}}),Array.from(e.values()).filter(l=>l.length>1).flat()});P(V,e=>{s.value=[...e],z.value=new Set(e.map(l=>l.key).filter(Boolean))},{immediate:!0});const B=async(e,l,o)=>{if(!b.value){if(l==="key"){k.value.set(e,o);const a=new Set(z.value),d=s.value[e];if(d&&a.delete(d.key),a.has(o))return}b.value=!0;try{const a=[...s.value],d=a[e];if(!d)return;a[e]={key:l==="key"?o:d.key,value:l==="value"?o:d.value},!a[e].key&&!a[e].value&&e!==a.length-1&&a.splice(e,1);const S=a.reduce((h,{key:j,value:I})=>((j||I)&&(h[j]=I),h),{});if(r.collection){const h={...r.collection["x-scalar-environments"],[r.environment.name]:{...r.collection["x-scalar-environments"]?.[r.environment.name],variables:S}};await t.edit(r.collection.uid,"x-scalar-environments",h)}if(e===s.value.length-1){const h=a[a.length-1];h&&(h.key||h.value)&&await v()}await J(),s.value=a,l==="key"&&(z.value=new Set(a.map(h=>h.key).filter(Boolean)),k.value.delete(e))}finally{b.value=!1}}},v=async()=>{if(!b.value){b.value=!0;try{const e=[...s.value,{key:"",value:""}],l=e.reduce((o,{key:a,value:d})=>((a||d)&&(o[a]=d),o),{});if(r.collection){const o={...r.collection["x-scalar-environments"],[r.environment.name]:{...r.collection["x-scalar-environments"]?.[r.environment.name],variables:l}};await t.edit(r.collection.uid,"x-scalar-environments",o)}await J(),s.value=e}finally{b.value=!1}}},E=async e=>{if(!b.value){b.value=!0;try{const l=[...s.value];l.splice(e,1);const o=l.reduce((a,{key:d,value:S})=>((d||S)&&(a[d]=S),a),{});if(r.collection){const a={...r.collection["x-scalar-environments"],[r.environment.name]:{...r.collection["x-scalar-environments"]?.[r.environment.name],variables:o}};await t.edit(r.collection.uid,"x-scalar-environments",a)}await J(),s.value=l}finally{b.value=!1}}},O=async()=>{if(s.value.length===0)await v();else if(s.value.length>=1){const e=s.value[s.value.length-1];e&&(e.key||e.value)&&await v()}};return me(()=>{O()}),P(()=>s.value,()=>{O()}),(e,l)=>(g(),$(ne,{class:"group/table flex-1",columns:["",""]},{default:f(()=>[u(K,{class:"sr-only !block"},{default:f(()=>[u(R,null,{default:f(()=>l[0]||(l[0]=[U("Key")])),_:1,__:[0]}),u(R,null,{default:f(()=>l[1]||(l[1]=[U("Value")])),_:1,__:[1]})]),_:1}),(g(!0),Y(Z,null,ee(F.value,(o,a)=>(g(),$(K,{key:a,class:fe({error:w.value.includes(a)})},{default:f(()=>[u(q,null,{default:f(()=>[u(H,{disableCloseBrackets:"",disableEnter:"",disableTabIndent:"",lineWrapping:"",environment:e.environment,envVariables:e.envVariables,modelValue:o.key,placeholder:"Key",workspace:e.workspace,"onUpdate:modelValue":d=>B(a,"key",d)},pe({_:2},[w.value.includes(a)?{name:"icon",fn:f(()=>[u(n(xe),{class:"text-red mr-0.75 size-3.5 brightness-[.9]"})]),key:"0"}:void 0]),1032,["environment","envVariables","modelValue","workspace","onUpdate:modelValue"])]),_:2},1024),u(q,null,{default:f(()=>[u(H,{class:"pr-6 group-hover:pr-10 group-has-[.cm-focused]:pr-10",disableCloseBrackets:"",disableEnter:"",disableTabIndent:"",lineWrapping:"",environment:e.environment,envVariables:e.envVariables,modelValue:o.value,placeholder:"Value",workspace:e.workspace,"onUpdate:modelValue":d=>B(a,"value",d)},{icon:f(()=>[o.key||o.value?(g(),$(n(W),{key:0,class:"text-c-2 hover:text-c-1 hover:bg-b-2 z-context hidden h-fit rounded p-1 group-hover:flex group-has-[.cm-focused]:flex",size:"sm",variant:"ghost",onClick:be(d=>E(a),["stop"])},{default:f(()=>[u(n(Q),{class:"size-3.5"})]),_:2},1032,["onClick"])):ae("",!0)]),_:2},1032,["environment","envVariables","modelValue","workspace","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1}))}}),ge=te(ye,[["__scopeId","data-v-83bfcc8a"]]),we={class:"flex h-full w-full flex-col gap-12 px-1.5 pt-8"},_e={class:"flex flex-col gap-4"},Ce={class:"rounded-lg border"},Ve={class:"bg-b-2 flex cursor-grab items-center justify-between rounded-t-lg px-1 py-1 text-sm"},Fe={class:"flex items-center"},Ee=["onClick"],Se={class:"text-c-3 flex h-full items-center justify-center rounded-lg border p-4"},Te=X({__name:"CollectionEnvironment",setup(r){const{activeCollection:t,activeWorkspace:s,activeEnvVariables:z}=oe(),{collectionMutators:k}=G(),b=D(),V=D(),F=D(),w=D(),B=C(""),v=C(null),E=C(void 0),O=T(()=>t.value?.["x-scalar-environments"]?Object.entries(t.value["x-scalar-environments"]).map(([c,i])=>({uid:c,name:c,value:JSON.stringify(i.variables||{}),color:i.color||"#FFFFFF"})):[]),e=()=>{!t.value?.uid||!v.value||(k.removeEnvironment(v.value,t.value.uid),V.hide())},l=c=>{v.value=c,V.show()},o=c=>{t.value?.uid&&(k.addEnvironment(c.name,{variables:{},color:c.color},t.value.uid),F.hide())},a=c=>{v.value=c.name,B.value=c.color||"#FFFFFF",b.show()},d=c=>{if(!t.value?.uid||!v.value)return;const i={...t.value["x-scalar-environments"],[v.value]:{variables:t.value["x-scalar-environments"]?.[v.value]?.variables||{},color:c}};k.edit(t.value.uid,"x-scalar-environments",i),b.hide()},S=c=>{v.value=c,E.value=c,w.show()},h=()=>{v.value=null,E.value=void 0,w.hide()},j=c=>{if(!t.value?.uid||!v.value)return;const i={...t.value["x-scalar-environments"]};if(!i[v.value])return;const m={},x=Object.entries(i),y=x.findIndex(([_])=>_===v.value);x.forEach(([_,M],A)=>{A===y?m[c]=M:m[_]=M}),k.edit(t.value.uid,"x-scalar-environments",m),v.value=null,E.value=void 0,w.hide()},I=(c,i)=>{if(!t.value?.uid)return;const m={...t.value["x-scalar-environments"]},x={},y=Object.entries(m),_=y.findIndex(([N])=>N===c.id),M=y.findIndex(([N])=>N===i.id);if(_===-1||M===-1)return;const A=y[_];A&&(y.splice(_,1),y.splice(M,0,A),y.forEach(([N,le])=>{x[N]=le}),k.edit(t.value.uid,"x-scalar-environments",x))};return(c,i)=>(g(),$(ue,null,{default:f(()=>[p("div",we,[p("div",_e,[i[5]||(i[5]=p("div",{class:"flex items-start justify-between gap-2"},[p("div",{class:"flex flex-col gap-2"},[p("div",{class:"flex h-8 items-center"},[p("h3",{class:"font-bold"},"Environment Variables")]),p("p",{class:"text-sm"},[U(" Set environment variables at your collection level. Use "),p("code",{class:"font-code text-c-2"},"{{ variable }}"),U(" to add / search among the selected environment's variables in your request inputs. ")])])],-1)),(g(!0),Y(Z,null,ee(O.value,m=>(g(),$(n(ie),{key:m.name,id:m.name,isDraggable:!0,isDroppable:!0,parentIds:[],onOnDragEnd:I},{default:f(()=>[p("div",Ce,[p("div",Ve,[p("div",Fe,[u(n(W),{class:"hover:bg-b-3 flex h-6 w-6 p-1",onClick:x=>a(m),variant:"ghost"},{default:f(()=>[p("span",{style:he({backgroundColor:m.color||"#FFFFFF"}),class:"h-2.5 w-2.5 rounded-full"},null,4)]),_:2},1032,["onClick"]),p("button",{class:"hover:bg-b-3 rounded px-1 py-0.5 text-sm",onClick:x=>S(m.name)},ke(m.name),9,Ee)]),u(n(W),{class:"hover:bg-b-3 hover:text-c-1 h-fit p-1.25",variant:"ghost",onClick:x=>l(m.name)},{default:f(()=>[u(n(Q),{class:"size-3.5"})]),_:2},1032,["onClick"])]),n(t)&&n(s)?(g(),$(ge,{key:0,collection:n(t),environment:m,envVariables:n(z),workspace:n(s)},null,8,["collection","environment","envVariables","workspace"])):ae("",!0)])]),_:2},1032,["id"]))),128)),p("div",Se,[u(n(W),{class:"hover:bg-b-2 hover:text-c-1 flex items-center gap-2",size:"sm",variant:"ghost",onClick:i[0]||(i[0]=m=>n(F).show())},{default:f(()=>[u(n(se),{class:"inline-flex",icon:"Add",size:"sm",thickness:"1.5"}),i[4]||(i[4]=p("span",null,"Add Environment",-1))]),_:1,__:[4]})])]),u(n(L),{size:"xxs",state:n(V),title:`Delete ${v.value||"Environment"}`},{default:f(()=>[u(re,{variableName:"Environment",warningMessage:"Are you sure you want to delete this environment? This action cannot be undone.",onClose:i[1]||(i[1]=m=>n(V).hide()),onDelete:e})]),_:1},8,["state","title"]),u(ve,{activeWorkspaceCollections:n(t)?[n(t)]:[],collectionId:n(t)?.uid,state:n(F),onCancel:i[2]||(i[2]=m=>n(F).hide()),onSubmit:o},null,8,["activeWorkspaceCollections","collectionId","state"]),u(de,{selectedColor:B.value,state:n(b),onCancel:i[3]||(i[3]=m=>n(b).hide()),onSubmit:d},null,8,["selectedColor","state"]),u(n(L),{size:"xxs",state:n(w),title:`Edit ${v.value}`},{default:f(()=>[u(ce,{name:E.value??"",onClose:h,onEdit:j},null,8,["name"])]),_:1},8,["state","title"])])]),_:1}))}});export{Te as default};
